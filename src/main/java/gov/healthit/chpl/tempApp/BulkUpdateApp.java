package gov.healthit.chpl.tempApp;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;
import java.util.concurrent.TimeUnit;

import org.apache.commons.lang.StringUtils;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;

import gov.healthit.chpl.tempApp.HttpUtil;
import gov.healthit.chpl.tempApp.Token;
import gov.healthit.chpl.domain.CertifiedProductSearchDetails;
import gov.healthit.chpl.domain.ListingUpdateRequest;
import gov.healthit.chpl.domain.search.BasicSearchResponse;
import gov.healthit.chpl.domain.search.CertifiedProductFlatSearchResult;

/**

Feature: Batch updating Disclosure URLs for ICSA

As ICSA, I want to change all of the Cerner Listings I manage to have the same new Disclosure URL

Scenario: Batch updating
Given ICSA has provided us with a list of the Listings they want to update
And ICSA has provided us with the new URL
When we execute a new SQL script
Then all of the Listings in the list will have an updated URL

Scenario: Handling errors
Given ICSA has provided us with a list of the Listings they want to update
And ICSA has provided us with the new URL
And some of the Listings in the list aren't managed by ICSA
When we execute a new SQL script
Then all of the Listings in the list not managed by ICSA won't be updated
And there will be an output report that lists those

 * 
 * @author dlucas
 *
 */
public class BulkUpdateApp extends App
{
	// 1,345 CHPL Product Numbers to update
	private static final String[] CHPL_PRODUCT_NUMBERS = {"14.03.07.1221.FIA1.01.1.1.160711","14.03.07.1221.FIA1.02.1.1.160711","14.03.07.1221.FIA1.03.1.1.160711","14.03.07.1221.FIA1.04.1.1.160711","14.03.07.1221.FIA2.01.1.1.160711","14.03.07.1221.FIA2.02.1.1.160711","14.03.07.1221.FIA2.03.1.1.160711","14.03.07.1221.FIA2.04.1.1.160711","14.03.07.1221.FIA4.01.1.0.160711","14.03.07.1221.FIA4.02.1.0.160711","14.03.07.1221.FIA4.03.1.0.160711","14.03.07.1221.FIA4.04.1.0.160711","14.03.07.1221.FII1.01.1.1.160711","14.03.07.1221.FII1.02.1.1.160711","14.03.07.1221.FII1.03.1.1.160711","14.03.07.1221.FII1.04.1.1.160711","14.03.07.1221.FII3.01.1.1.160711","14.03.07.1221.FII3.02.1.1.160711","14.03.07.1221.FII3.03.1.1.160711","14.03.07.1221.FII3.04.1.1.160711","14.03.07.1221.FII4.01.1.0.160711","14.03.07.1221.FII4.02.1.0.160711","14.03.07.1221.FII4.03.1.0.160711","14.03.07.1221.FII4.04.1.0.160711","14.03.07.1221.HEA2.01.1.1.160711","14.03.07.1221.HEA2.02.1.1.160711","14.03.07.1221.HEA2.03.1.1.160711","14.03.07.1221.HEA2.04.1.1.160711","14.03.07.1221.HEA3.01.1.1.160711","14.03.07.1221.HEA3.02.1.1.160711","14.03.07.1221.HEA3.03.1.1.160711","14.03.07.1221.HEA3.04.1.1.160711","14.03.07.1221.HEI2.01.1.1.160711","14.03.07.1221.HEI2.02.1.1.160711","14.03.07.1221.HEI2.03.1.1.160711","14.03.07.1221.HEI2.04.1.1.160711","14.03.07.1221.HEI3.01.1.1.160711","14.03.07.1221.HEI3.02.1.1.160711","14.03.07.1221.HEI3.03.1.1.160711","14.03.07.1221.HEI3.04.1.1.160711","14.03.07.1221.PAA3.01.1.1.160711","14.03.07.1221.PAA3.02.1.1.160711","14.03.07.1221.PAA3.03.1.1.160711","14.03.07.1221.PAA3.04.1.1.160711","14.03.07.1221.PAI3.01.1.1.160711","14.03.07.1221.PAI3.02.1.1.160711","14.03.07.1221.PAI3.03.1.1.160711","14.03.07.1221.PAI3.04.1.1.160711","14.03.07.1221.POA4.01.1.0.160711","14.03.07.1221.POA4.02.1.0.160711","14.03.07.1221.POA4.03.1.0.160711","14.03.07.1221.POA4.04.1.0.160711","14.03.07.1221.POA5.01.1.1.160711","14.03.07.1221.POA5.02.1.1.160711","14.03.07.1221.POA5.03.1.1.160711","14.03.07.1221.POA5.04.1.1.160711","14.03.07.1221.POI2.01.1.1.160711","14.03.07.1221.POI2.02.1.1.160711","14.03.07.1221.POI2.03.1.1.160711","14.03.07.1221.POI2.04.1.1.160711","14.03.07.1221.POI3.01.1.1.160711","14.03.07.1221.POI3.02.1.1.160711","14.03.07.1221.POI3.03.1.1.160711","14.03.07.1221.POI3.04.1.1.160711","14.03.07.1221.POI4.01.1.0.160711","14.03.07.1221.POI4.02.1.0.160711","14.03.07.1221.POI4.03.1.0.160711","14.03.07.1221.POI4.04.1.0.160711","14.03.07.1221.POI5.01.1.1.160711","14.03.07.1221.POI5.02.1.1.160711","14.03.07.1221.POI5.03.1.1.160711","14.03.07.1221.POI5.04.1.1.160711","14.03.07.1222.FIAM.99.1.1.140818","14.07.07.1221.CEA1.01.1.0.160502","14.07.07.1221.CEA1.02.1.0.160502","14.07.07.1221.CEA1.03.1.0.160502","14.07.07.1221.CEA1.04.1.0.160502","14.07.07.1221.CEA1.05.1.0.160901","14.07.07.1221.CEA1.06.1.0.160901","14.07.07.1221.CEA1.07.1.0.160901","14.07.07.1221.CEA1.08.1.0.160901","14.07.07.1221.CEA1.09.1.0.160901","14.07.07.1221.CEA1.10.1.0.161122","14.07.07.1221.CEA1.11.1.0.161122","14.07.07.1221.CEA1.12.1.0.161122","14.07.07.1221.CEA1.13.1.0.170116","14.07.07.1221.CEA1.14.1.0.170310","14.07.07.1221.CEA1.15.1.0.170310","14.07.07.1221.CEA1.16.1.0.170310","14.07.07.1221.CEI1.01.1.0.160502","14.07.07.1221.CEI1.02.1.0.160502","14.07.07.1221.CEI1.03.1.0.160502","14.07.07.1221.CEI1.04.1.0.160502","14.07.07.1221.CEI1.05.1.0.160901","14.07.07.1221.CEI1.06.1.0.160901","14.07.07.1221.CEI1.07.1.0.160901","14.07.07.1221.CEI1.08.1.0.160901","14.07.07.1221.CEI1.09.1.0.160901","14.07.07.1221.CEI1.10.1.0.161122","14.07.07.1221.CEI1.11.1.0.161122","14.07.07.1221.CEI1.12.1.0.161122","14.07.07.1221.CEI1.13.1.0.170116","14.07.07.1221.CEI1.14.1.0.170310","14.07.07.1221.CEI1.15.1.0.170310","14.07.07.1221.CEI1.16.1.0.170310","14.07.07.1221.FIA1.04.1.1.160906","14.07.07.1221.FIA1.04.1.1.161108","14.07.07.1221.FIA1.04.1.1.161227","14.07.07.1221.FIA1.08.1.1.170308","14.07.07.1221.FIA1.09.1.1.170308","14.07.07.1221.FIA2.04.1.1.160906","14.07.07.1221.FIA2.04.1.1.161108","14.07.07.1221.FIA2.04.1.1.161227","14.07.07.1221.FIA2.08.1.1.170308","14.07.07.1221.FIA2.09.1.1.170308","14.07.07.1221.FIA4.04.1.0.160906","14.07.07.1221.FIA4.04.1.0.161108","14.07.07.1221.FIA4.04.1.0.161227","14.07.07.1221.FIA4.08.1.0.170308","14.07.07.1221.FII1.04.1.1.160906","14.07.07.1221.FII1.04.1.1.161108","14.07.07.1221.FII1.04.1.1.161227","14.07.07.1221.FII1.08.1.1.170308","14.07.07.1221.FII1.09.1.1.170308","14.07.07.1221.FII3.04.1.1.160906","14.07.07.1221.FII3.04.1.1.161108","14.07.07.1221.FII3.04.1.1.161227","14.07.07.1221.FII3.08.1.1.170308","14.07.07.1221.FII4.04.1.0.160906","14.07.07.1221.FII4.04.1.0.161108","14.07.07.1221.FII4.04.1.0.161227","14.07.07.1221.FII4.08.1.0.170308","14.07.07.1221.HEA2.04.1.1.160906","14.07.07.1221.HEA2.04.1.1.161108","14.07.07.1221.HEA2.04.1.1.161227","14.07.07.1221.HEA2.08.1.1.170308","14.07.07.1221.HEA2.09.1.1.170308","14.07.07.1221.HEA2.10.1.1.170308","14.07.07.1221.HEA2.11.1.1.170308","14.07.07.1221.HEA2.12.1.1.170308","14.07.07.1221.HEA2.13.1.1.170308","14.07.07.1221.HEA2.14.1.1.170308","14.07.07.1221.HEA3.04.1.1.160906","14.07.07.1221.HEA3.04.1.1.161108","14.07.07.1221.HEA3.04.1.1.161227","14.07.07.1221.HEA3.08.1.1.170308","14.07.07.1221.HEA3.09.1.1.170308","14.07.07.1221.HEI2.04.1.1.160906","14.07.07.1221.HEI2.04.1.1.161108","14.07.07.1221.HEI2.04.1.1.161227","14.07.07.1221.HEI2.08.1.1.170308","14.07.07.1221.HEI2.09.1.1.170308","14.07.07.1221.HEI2.10.1.1.170308","14.07.07.1221.HEI2.11.1.1.170308","14.07.07.1221.HEI2.12.1.1.170308","14.07.07.1221.HEI2.13.1.1.170308","14.07.07.1221.HEI2.14.1.1.170308","14.07.07.1221.HEI3.04.1.1.160906","14.07.07.1221.HEI3.04.1.1.161108","14.07.07.1221.HEI3.04.1.1.161227","14.07.07.1221.HEI3.08.1.1.170308","14.07.07.1221.HEI3.09.1.1.170308","14.07.07.1221.P2A0.01.1.0.170210","14.07.07.1221.P2I0.01.1.0.170210","14.07.07.1221.PAA3.04.1.1.160906","14.07.07.1221.PAA3.04.1.1.161108","14.07.07.1221.PAA3.04.1.1.161227","14.07.07.1221.PAA3.08.1.1.170308","14.07.07.1221.PAI3.04.1.1.160906","14.07.07.1221.PAI3.04.1.1.161108","14.07.07.1221.PAI3.04.1.1.161227","14.07.07.1221.PAI3.08.1.1.170308","14.07.07.1221.POA1.01.1.1.160711","14.07.07.1221.POA1.02.1.1.160711","14.07.07.1221.POA1.03.1.1.160711","14.07.07.1221.POA1.04.1.1.160711","14.07.07.1221.POA1.04.1.1.160906","14.07.07.1221.POA1.04.1.1.161108","14.07.07.1221.POA1.04.1.1.161227","14.07.07.1221.POA1.08.1.1.170308","14.07.07.1221.POA1.09.1.1.170308","14.07.07.1221.POA1.10.1.1.170308","14.07.07.1221.POA1.11.1.1.170308","14.07.07.1221.POA1.12.1.1.170308","14.07.07.1221.POA1.13.1.1.170308","14.07.07.1221.POA1.14.1.1.170308","14.07.07.1221.POA4.04.1.0.160906","14.07.07.1221.POA4.04.1.0.161108","14.07.07.1221.POA4.04.1.0.161227","14.07.07.1221.POA4.08.1.0.170308","14.07.07.1221.POA5.04.1.1.160906","14.07.07.1221.POA5.04.1.1.161108","14.07.07.1221.POA5.04.1.1.161227","14.07.07.1221.POA5.08.1.1.170308","14.07.07.1221.POA5.09.1.1.170308","14.07.07.1221.POA5.10.1.1.170308","14.07.07.1221.POA5.11.1.1.170308","14.07.07.1221.POA5.12.1.1.170308","14.07.07.1221.POA5.13.1.1.170308","14.07.07.1221.POA5.14.1.1.170308","14.07.07.1221.POA6.02.1.1.161012","14.07.07.1221.POA6.03.1.1.161012","14.07.07.1221.POA6.04.1.1.161012","14.07.07.1221.POA6.05.1.1.161012","14.07.07.1221.POA7.01.1.1.161012","14.07.07.1221.POA8.06.1.1.170120","14.07.07.1221.POA8.07.1.1.170120","14.07.07.1221.POA8.08.1.1.170313","14.07.07.1221.POA8.09.1.1.170313","14.07.07.1221.POA8.10.1.1.170313","14.07.07.1221.POI2.04.1.1.160906","14.07.07.1221.POI2.04.1.1.161108","14.07.07.1221.POI2.04.1.1.161227","14.07.07.1221.POI2.08.1.1.170308","14.07.07.1221.POI2.09.1.1.170308","14.07.07.1221.POI2.10.1.1.170308","14.07.07.1221.POI2.11.1.1.170308","14.07.07.1221.POI2.12.1.1.170308","14.07.07.1221.POI2.13.1.1.170308","14.07.07.1221.POI2.14.1.1.170308","14.07.07.1221.POI3.04.1.1.160906","14.07.07.1221.POI3.04.1.1.161108","14.07.07.1221.POI3.04.1.1.161227","14.07.07.1221.POI3.08.1.1.170308","14.07.07.1221.POI3.09.1.1.170308","14.07.07.1221.POI3.10.1.1.170308","14.07.07.1221.POI3.11.1.1.170308","14.07.07.1221.POI3.12.1.1.170308","14.07.07.1221.POI3.13.1.1.170308","14.07.07.1221.POI3.14.1.1.170308","14.07.07.1221.POI4.04.1.0.160906","14.07.07.1221.POI4.04.1.0.161108","14.07.07.1221.POI4.04.1.0.161227","14.07.07.1221.POI4.08.1.0.170308","14.07.07.1221.POI5.04.1.1.160906","14.07.07.1221.POI5.04.1.1.161108","14.07.07.1221.POI5.04.1.1.161227","14.07.07.1221.POI5.08.1.1.170308","14.07.07.1221.POI5.09.1.1.170308","14.07.07.1221.POI5.10.1.1.170308","14.07.07.1221.POI5.11.1.1.170308","14.07.07.1221.POI5.12.1.1.170308","14.07.07.1221.POI5.13.1.1.170308","14.07.07.1221.POI5.14.1.1.170308","14.07.07.1221.POI7.01.1.0.161012","14.07.07.1221.POI7.02.1.0.161012","14.07.07.1221.POI7.03.1.0.161012","14.07.07.1221.POI7.04.1.0.161012","14.07.07.1221.POI7.05.1.0.161012","14.07.07.1221.POI8.06.1.0.170120","14.07.07.1221.POI8.07.1.0.170120","14.07.07.1221.POI8.08.1.0.170313","14.07.07.1221.POI8.09.1.0.170313","14.07.07.1221.POI8.10.1.0.170313","14.07.07.1222.MOA1.01.1.0.160331","14.07.07.1222.MOA1.02.1.0.160831","14.07.07.1222.MOA1.03.1.0.161230","14.07.07.1222.MOA2.01.1.0.160331","14.07.07.1222.MOA2.02.1.0.160831","14.07.07.1222.MOA2.03.1.0.161230","14.07.07.1222.MOI1.01.1.0.160331","14.07.07.1222.MOI1.02.1.0.160831","14.07.07.1222.MOI1.03.1.0.161230","CHP-019313","CHP-019314","CHP-019348","CHP-019350","CHP-019351","CHP-019352","CHP-019400","CHP-019402","CHP-019403","CHP-019404","CHP-019645","CHP-019646","CHP-019647","CHP-019648","CHP-019789","CHP-019790","CHP-019791","CHP-019792","CHP-019793","CHP-019794","CHP-019795","CHP-019796","CHP-019816","CHP-019817","CHP-019818","CHP-019847","CHP-019848","CHP-019916","CHP-019917","CHP-019918","CHP-019919","CHP-019920","CHP-019921","CHP-019922","CHP-019923","CHP-019924","CHP-019925","CHP-019926","CHP-019927","CHP-020897","CHP-020898","CHP-020899","CHP-020900","CHP-020901","CHP-020902","CHP-020903","CHP-020904","CHP-020905","CHP-020906","CHP-020907","CHP-020908","CHP-020909","CHP-020910","CHP-020911","CHP-020912","CHP-020913","CHP-020914","CHP-020915","CHP-020916","CHP-020917","CHP-020918","CHP-020919","CHP-020920","CHP-020921","CHP-020922","CHP-020923","CHP-020924","CHP-020925","CHP-021128","CHP-021129","CHP-021130","CHP-021131","CHP-021132","CHP-021133","CHP-021134","CHP-021135","CHP-021136","CHP-021145","CHP-021164","CHP-021165","CHP-021166","CHP-021288","CHP-021289","CHP-021405","CHP-021406","CHP-021407","CHP-021408","CHP-021409","CHP-021410","CHP-021411","CHP-021412","CHP-021413","CHP-021414","CHP-021417","CHP-021531","CHP-021532","CHP-021631","CHP-021632","CHP-021634","CHP-021635","CHP-021636","CHP-021637","CHP-021638","CHP-021640","CHP-021658","CHP-021659","CHP-021660","CHP-021665","CHP-021666","CHP-021667","CHP-021668","CHP-021669","CHP-021670","CHP-021671","CHP-021672","CHP-021673","CHP-021674","CHP-021675","CHP-021676","CHP-021677","CHP-021678","CHP-021679","CHP-021680","CHP-021681","CHP-021682","CHP-021711","CHP-021712","CHP-021713","CHP-021714","CHP-021715","CHP-021716","CHP-021717","CHP-021718","CHP-021719","CHP-021720","CHP-021736","CHP-021737","CHP-021738","CHP-021739","CHP-021740","CHP-021741","CHP-021742","CHP-021781","CHP-021825","CHP-021826","CHP-021827","CHP-021828","CHP-021829","CHP-021830","CHP-021831","CHP-021863","CHP-021864","CHP-021865","CHP-021866","CHP-021867","CHP-021868","CHP-021869","CHP-021876","CHP-021923","CHP-021924","CHP-021925","CHP-021926","CHP-021927","CHP-021928","CHP-021929","CHP-021930","CHP-021931","CHP-021932","CHP-021933","CHP-021934","CHP-021935","CHP-021936","CHP-021937","CHP-021938","CHP-021939","CHP-021940","CHP-021941","CHP-021942","CHP-021943","CHP-021944","CHP-021945","CHP-021946","CHP-021947","CHP-021948","CHP-021949","CHP-021950","CHP-021951","CHP-021952","CHP-021953","CHP-021955","CHP-021956","CHP-021957","CHP-021958","CHP-021959","CHP-021960","CHP-021967","CHP-022085","CHP-022086","CHP-022087","CHP-022088","CHP-022089","CHP-022090","CHP-022091","CHP-022092","CHP-022093","CHP-022094","CHP-022095","CHP-022113","CHP-022114","CHP-022115","CHP-022117","CHP-022182","CHP-022190","CHP-022478","CHP-022479","CHP-022549","CHP-022550","CHP-022551","CHP-022554","CHP-022555","CHP-022556","CHP-022557","CHP-022558","CHP-022559","CHP-022560","CHP-022561","CHP-022562","CHP-022563","CHP-022564","CHP-022836","CHP-022996","CHP-023074","CHP-023078","CHP-023081","CHP-023082","CHP-023083","CHP-023117","CHP-023118","CHP-023119","CHP-023120","CHP-023121","CHP-023122","CHP-023123","CHP-023124","CHP-023125","CHP-023126","CHP-023127","CHP-023128","CHP-023129","CHP-023130","CHP-023131","CHP-023132","CHP-023133","CHP-023134","CHP-023135","CHP-023189","CHP-023190","CHP-023191","CHP-023192","CHP-023194","CHP-023195","CHP-023196","CHP-023197","CHP-023222","CHP-023223","CHP-023224","CHP-023225","CHP-023226","CHP-023227","CHP-023228","CHP-023229","CHP-023230","CHP-023231","CHP-023232","CHP-023312","CHP-023313","CHP-023315","CHP-023316","CHP-023317","CHP-023318","CHP-023319","CHP-023320","CHP-023321","CHP-023322","CHP-023323","CHP-023324","CHP-023325","CHP-023326","CHP-023327","CHP-023328","CHP-023329","CHP-023330","CHP-023331","CHP-023332","CHP-023333","CHP-023334","CHP-023590","CHP-023591","CHP-023638","CHP-023639","CHP-023640","CHP-023651","CHP-023652","CHP-023653","CHP-023654","CHP-023655","CHP-023656","CHP-023657","CHP-023658","CHP-023659","CHP-023660","CHP-023661","CHP-023665","CHP-023666","CHP-023667","CHP-023668","CHP-023669","CHP-023670","CHP-023671","CHP-023672","CHP-023673","CHP-023674","CHP-023675","CHP-023676","CHP-023677","CHP-023850","CHP-023852","CHP-023853","CHP-023854","CHP-023856","CHP-023857","CHP-023858","CHP-023859","CHP-023860","CHP-023861","CHP-023862","CHP-023863","CHP-023864","CHP-023865","CHP-023866","CHP-023868","CHP-023870","CHP-023871","CHP-023873","CHP-023874","CHP-023875","CHP-023877","CHP-023939","CHP-023995","CHP-024021","CHP-024023","CHP-024030","CHP-024138","CHP-024150","CHP-024151","CHP-024152","CHP-024153","CHP-024154","CHP-024155","CHP-024156","CHP-024157","CHP-024159","CHP-024160","CHP-024161","CHP-024162","CHP-024170","CHP-024171","CHP-024172","CHP-024173","CHP-024174","CHP-024175","CHP-024176","CHP-024186","CHP-024189","CHP-024240","CHP-024244","CHP-024254","CHP-024459","CHP-024460","CHP-024473","CHP-024474","CHP-024479","CHP-024694","CHP-024695","CHP-024696","CHP-024697","CHP-024698","CHP-024699","CHP-024700","CHP-024701","CHP-024702","CHP-024703","CHP-024704","CHP-024705","CHP-024706","CHP-024707","CHP-024708","CHP-024709","CHP-024710","CHP-024711","CHP-024712","CHP-024713","CHP-024714","CHP-024715","CHP-024716","CHP-024719","CHP-024720","CHP-024721","CHP-024723","CHP-024724","CHP-024725","CHP-024726","CHP-024727","CHP-024728","CHP-024729","CHP-024730","CHP-024731","CHP-024732","CHP-024733","CHP-024735","CHP-024736","CHP-024737","CHP-024738","CHP-024739","CHP-024744","CHP-024944","CHP-024945","CHP-024946","CHP-024947","CHP-024948","CHP-024949","CHP-024950","CHP-024951","CHP-024952","CHP-024953","CHP-024954","CHP-024955","CHP-024956","CHP-024957","CHP-024958","CHP-024959","CHP-024960","CHP-024961","CHP-024962","CHP-024963","CHP-024964","CHP-024966","CHP-024968","CHP-024988","CHP-024990","CHP-025007","CHP-025008","CHP-025009","CHP-025010","CHP-025011","CHP-025012","CHP-025013","CHP-025014","CHP-025015","CHP-025018","CHP-025019","CHP-025020","CHP-025021","CHP-025022","CHP-025023","CHP-025024","CHP-025025","CHP-025026","CHP-025027","CHP-025028","CHP-025029","CHP-025100","CHP-025158","CHP-025159","CHP-025160","CHP-025161","CHP-025162","CHP-025163","CHP-025164","CHP-025165","CHP-025166","CHP-025167","CHP-025168","CHP-025169","CHP-025170","CHP-025171","CHP-025172","CHP-025173","CHP-025174","CHP-025175","CHP-025176","CHP-025177","CHP-025178","CHP-025179","CHP-025180","CHP-025182","CHP-025183","CHP-025184","CHP-025185","CHP-025186","CHP-025187","CHP-025188","CHP-025189","CHP-025190","CHP-025191","CHP-025192","CHP-025193","CHP-025194","CHP-025195","CHP-025196","CHP-025197","CHP-025198","CHP-025199","CHP-025200","CHP-025201","CHP-025268","CHP-025269","CHP-025270","CHP-025271","CHP-025272","CHP-025273","CHP-025276","CHP-025277","CHP-025278","CHP-025279","CHP-025281","CHP-025282","CHP-025283","CHP-025284","CHP-025285","CHP-025286","CHP-025287","CHP-025288","CHP-025289","CHP-025290","CHP-025291","CHP-025292","CHP-025295","CHP-025296","CHP-025298","CHP-025299","CHP-025345","CHP-025346","CHP-025347","CHP-025348","CHP-025349","CHP-025350","CHP-025351","CHP-025352","CHP-025353","CHP-025354","CHP-025355","CHP-025356","CHP-025357","CHP-025358","CHP-025359","CHP-025360","CHP-025361","CHP-025362","CHP-025363","CHP-025364","CHP-025365","CHP-025366","CHP-025367","CHP-025368","CHP-025369","CHP-025370","CHP-025371","CHP-025372","CHP-025373","CHP-025385","CHP-025386","CHP-025387","CHP-025388","CHP-025389","CHP-025390","CHP-025391","CHP-025392","CHP-025393","CHP-025394","CHP-025395","CHP-025396","CHP-025397","CHP-025398","CHP-025399","CHP-025400","CHP-025401","CHP-025402","CHP-025403","CHP-025421","CHP-025422","CHP-025423","CHP-025424","CHP-025425","CHP-025426","CHP-025427","CHP-025428","CHP-025429","CHP-025440","CHP-025442","CHP-025443","CHP-025444","CHP-025445","CHP-025446","CHP-025447","CHP-025448","CHP-025451","CHP-025452","CHP-025453","CHP-025454","CHP-025455","CHP-025456","CHP-025460","CHP-025461","CHP-025462","CHP-025463","CHP-025464","CHP-025465","CHP-025466","CHP-025467","CHP-025468","CHP-025469","CHP-025470","CHP-025471","CHP-025472","CHP-025473","CHP-025474","CHP-025475","CHP-025476","CHP-025477","CHP-025478","CHP-025479","CHP-025480","CHP-025481","CHP-025482","CHP-025483","CHP-025527","CHP-025532","CHP-025533","CHP-025534","CHP-025535","CHP-025536","CHP-025537","CHP-025538","CHP-025540","CHP-025541","CHP-025542","CHP-025543","CHP-027073","CHP-027074","CHP-027075","CHP-027076","CHP-027077","CHP-027078","CHP-027079","CHP-027080","CHP-027081","CHP-027082","CHP-027083","CHP-027084","CHP-027085","CHP-027086","CHP-027087","CHP-027088","CHP-027089","CHP-027090","CHP-027091","CHP-027092","CHP-027093","CHP-027094","CHP-027095","CHP-027096","CHP-027097","CHP-027098","CHP-027099","CHP-027100","CHP-027101","CHP-027102","CHP-027103","CHP-027104","CHP-027106","CHP-027107","CHP-027108","CHP-027111","CHP-027112","CHP-027113","CHP-027114","CHP-027115","CHP-027116","CHP-027117","CHP-027125","CHP-027265","CHP-027267","CHP-027268","CHP-027269","CHP-027270","CHP-027920","CHP-027921","CHP-027935","CHP-027936","CHP-027937","CHP-027938","CHP-027939","CHP-027940","CHP-027941","CHP-027942","CHP-027943","CHP-027944","CHP-027945","CHP-027946","CHP-027947","CHP-027948","CHP-027949","CHP-027950","CHP-027951","CHP-027952","CHP-027953","CHP-027954","CHP-027956","CHP-027957","CHP-027958","CHP-027959","CHP-027960","CHP-027961","CHP-027962","CHP-027963","CHP-027964","CHP-027965","CHP-027966","CHP-027967","CHP-027968","CHP-027969","CHP-027970","CHP-027971","CHP-027972","CHP-027973","CHP-027974","CHP-027975","CHP-027976","CHP-027977","CHP-027978","CHP-027979","CHP-027980","CHP-027981","CHP-027994","CHP-027995","CHP-027996","CHP-027997","CHP-027998","CHP-027999","CHP-028000","CHP-028001","CHP-028002","CHP-028003","CHP-028004","CHP-028005","CHP-028006","CHP-028007","CHP-028008","CHP-028009","CHP-028010","CHP-028011","CHP-028012","CHP-028013","CHP-028014","CHP-028015","CHP-028016","CHP-028017","CHP-028018","CHP-028019","CHP-028020","CHP-028021","CHP-028022","CHP-028023","CHP-028024","CHP-028025","CHP-028026","CHP-028027","CHP-028028","CHP-028029","CHP-028030","CHP-028031","CHP-028032","CHP-028033","CHP-028048","CHP-028049","CHP-028050","CHP-028051","CHP-028052","CHP-028053","CHP-028054","CHP-028055","CHP-028056","CHP-028057","CHP-028058","CHP-028059","CHP-028060","CHP-028061","CHP-028062","CHP-028063","CHP-028064","CHP-028065","CHP-028066","CHP-028067","CHP-028068","CHP-028069","CHP-028070","CHP-028071","CHP-028072","CHP-028073","CHP-028074","CHP-028075","CHP-028076","CHP-028077","CHP-028078","CHP-028079","CHP-028080","CHP-028081","CHP-028082","CHP-028083","CHP-028084","CHP-028085","CHP-028299","CHP-028300","CHP-028301","CHP-028302","CHP-028303","CHP-028304","CHP-028305","CHP-028306","CHP-028307","CHP-028308","CHP-028309","CHP-028310","CHP-028311","CHP-028312","CHP-028313","CHP-028314","CHP-028315","CHP-028316","CHP-028317","CHP-028318","CHP-028319","CHP-028320","CHP-028321","CHP-028322","CHP-028323","CHP-028324","CHP-028325","CHP-028326","CHP-028327","CHP-028328","CHP-028335","CHP-028337","CHP-028338","CHP-028339","CHP-028340","CHP-028341","CHP-028342","CHP-028343","CHP-028344","CHP-028345","CHP-028346","CHP-028347","CHP-028348","CHP-028349","CHP-028350","CHP-028351","CHP-028352","CHP-028353","CHP-028354","CHP-028429","CHP-028431","CHP-028433","CHP-028435","CHP-028457","CHP-028458","CHP-028459","CHP-028460","CHP-028461","CHP-028462","CHP-028463","CHP-028464","CHP-028465","CHP-028466","CHP-028467","CHP-028468","CHP-028469","CHP-028470","CHP-028471","CHP-028472","CHP-028473","CHP-028474","CHP-028475","CHP-028479","CHP-028480","CHP-028481","CHP-028482","CHP-028483","CHP-028484","CHP-028485","CHP-028486","CHP-028487","CHP-028488","CHP-028489","CHP-028490","CHP-028491","CHP-028492","CHP-028493","CHP-028494","CHP-028495","CHP-028496","CHP-028497","CHP-028498","CHP-028499","CHP-028500","CHP-028501","CHP-028502","CHP-028503","CHP-028504","CHP-028505","CHP-028506","CHP-028507","CHP-028508","CHP-028509","CHP-028510","CHP-028511","CHP-028512","CHP-028513","CHP-028514","CHP-028515","CHP-028516","CHP-028532","CHP-028533","CHP-028534","CHP-028535","CHP-028536","CHP-028537","CHP-028538","CHP-028540","CHP-028541","CHP-028542","CHP-028543","CHP-028547","CHP-028548","CHP-028549","CHP-028551","CHP-028552","CHP-028553","CHP-028554","CHP-028555","CHP-028556","CHP-028557","CHP-028558","CHP-028559","CHP-028560","CHP-028561","CHP-028562","CHP-028563","CHP-028564","CHP-028565","CHP-028566","CHP-028567","CHP-028568","CHP-028569","CHP-028570","CHP-028571","CHP-028572","CHP-028573","CHP-028574","CHP-028575","CHP-028576","CHP-028577","CHP-028578","CHP-028579","CHP-028580","CHP-028581","CHP-028582","CHP-028583","CHP-028584","CHP-028585","CHP-028586","CHP-028587","CHP-028588","CHP-028589","CHP-028590","CHP-028591","CHP-028592","CHP-028593","CHP-028682","CHP-028686","CHP-028687","CHP-028688","CHP-028689","CHP-028690","CHP-028691","CHP-028692","CHP-028693","CHP-028694","CHP-028695","CHP-028696","CHP-028697","CHP-028698","CHP-028699","CHP-028700","CHP-028701","CHP-028702","CHP-028703","CHP-028712","CHP-028715","CHP-028963","CHP-028977","CHP-028978","CHP-028981","CHP-028982","CHP-028983","CHP-028984","CHP-028985","CHP-028986","CHP-028988","CHP-028989","CHP-028990","CHP-028991","CHP-028992","CHP-028993","CHP-028994","CHP-028995","CHP-028996","CHP-028997","CHP-028998","CHP-028999","CHP-029000","CHP-029001","CHP-029002","CHP-029003","CHP-029004","CHP-029005","CHP-029137","CHP-029139","CHP-029140","CHP-029144","CHP-029150","CHP-029153","CHP-029154","CHP-029187","CHP-029188","CHP-029189","CHP-029190","CHP-029191","CHP-029192","CHP-029193","CHP-029194","CHP-029195","CHP-029196","CHP-029197","CHP-029198","CHP-029199","CHP-029200","CHP-029201","CHP-029202","CHP-029203","CHP-029204","CHP-029205","CHP-029211","CHP-029212","CHP-029213","CHP-029214","CHP-029215","CHP-029216","CHP-029217","CHP-029218","CHP-029219","CHP-029220","CHP-029221","CHP-029222","CHP-029223","CHP-029224","CHP-029225","CHP-029226","CHP-029227","CHP-029228","CHP-029229"};
	private static final String ICSA_LABS_NAME = "ICSA Labs";
	private static final Logger logger = LogManager.getLogger(BulkUpdateApp.class);
	
    public static void main(String[] args) throws IOException
    {
    	BulkUpdateApp bulkUpdateApp = new BulkUpdateApp();
    	Properties props = bulkUpdateApp.getProperties();
    	List<CertifiedProductSearchDetails> nonICSAManagedCPSearchDetails = new ArrayList<CertifiedProductSearchDetails>();
    	List<CertifiedProductSearchDetails> iCSAManagedCPSearchDetails = new ArrayList<CertifiedProductSearchDetails>();
    	List<CertifiedProductSearchDetails> preUpdatediCSAManagedCPSearchDetails = new ArrayList<CertifiedProductSearchDetails>();
    	
    	BasicSearchResponse searchResponse = bulkUpdateApp.getAllCertifiedProductsBasicSearchResponse(props);
    	List<CertifiedProductSearchDetails> allCPSearchDetails = bulkUpdateApp.getAllCertifiedProductSearchDetails(searchResponse, props);
    	
    	logger.info("Get lists of ICSA managed/non-managed CertifiedProductSearchDetails");
    	for(CertifiedProductSearchDetails cpDetails : allCPSearchDetails){
    		if(cpDetails.getCertifyingBody().containsValue(ICSA_LABS_NAME)){
    			if(!StringUtils.isEmpty(cpDetails.getTransparencyAttestationUrl()) && !cpDetails.getTransparencyAttestationUrl().equalsIgnoreCase(props.getProperty("transparencyAttestationUrl"))){
    				iCSAManagedCPSearchDetails.add(cpDetails);
    			}
    			else if(!StringUtils.isEmpty(cpDetails.getTransparencyAttestationUrl()) && cpDetails.getTransparencyAttestationUrl().equalsIgnoreCase(props.getProperty("transparencyAttestationUrl"))){
    				preUpdatediCSAManagedCPSearchDetails.add(cpDetails);
    			}
    		}
    		else{
    			nonICSAManagedCPSearchDetails.add(cpDetails);
    		}
    	}
    	
    	System.out.println("The following are a list of " + preUpdatediCSAManagedCPSearchDetails.size() + " pre-updated ICSA managed CHPL Product Numbers: ");
    	bulkUpdateApp.printChplProductNumbers(preUpdatediCSAManagedCPSearchDetails);
    	System.out.println("The following are a list of " + nonICSAManagedCPSearchDetails.size() + " non-ICSA managed CHPL Product Numbers: ");
    	bulkUpdateApp.printChplProductNumbers(nonICSAManagedCPSearchDetails);
    	System.out.println("The following are a list of " + iCSAManagedCPSearchDetails.size() + " ICSA managed CHPL Product Numbers to update: ");
    	bulkUpdateApp.printChplProductNumbers(iCSAManagedCPSearchDetails);
    	System.out.println("The following are a list of " + iCSAManagedCPSearchDetails.size() + " ICSA managed CHPL ids to update: ");
    	bulkUpdateApp.printCertifiedProductId(iCSAManagedCPSearchDetails);
    	
    	logger.info("Get authentication token for REST API call");
    	Token token = new Token(props);
    	token = token.getNewToken(props);
    	
    	bulkUpdateApp.updateDisclosureURLs(props, iCSAManagedCPSearchDetails, token);
    }
    
    private BasicSearchResponse getAllCertifiedProductsBasicSearchResponse(Properties props) throws JsonParseException, JsonMappingException, IOException{
    	logger.info("Get all Certified Products in BasicSearchResponse object");
    	String allCPsJsonResult = HttpUtil.getRequest(props.getProperty("chplUrlBegin") + props.getProperty("basePath") + props.getProperty("getAllCertifiedProductsBulkUpdate"), null, props);
        	ObjectMapper viewMapper = new ObjectMapper();
        	BasicSearchResponse searchResponse = new BasicSearchResponse();
        	searchResponse = viewMapper.readValue(allCPsJsonResult, BasicSearchResponse.class);
    		return searchResponse;
    }
    
    private List<CertifiedProductSearchDetails> getAllCertifiedProductSearchDetails(BasicSearchResponse searchResponse, Properties props) throws JsonParseException, JsonMappingException, IOException{
    	logger.info("Get all Certified Product Search Details for each CP to update with new Disclosure URL");
    	List<CertifiedProductSearchDetails> allCPSearchDetails = new ArrayList<CertifiedProductSearchDetails>();
        	for(CertifiedProductFlatSearchResult flatSearchResult : searchResponse.getResults()){
        		for(String chplProductNumber : CHPL_PRODUCT_NUMBERS){
        			if(flatSearchResult.getChplProductNumber().equalsIgnoreCase(chplProductNumber)){
        				logger.info("Get CertifiedProductSearchDetails for " + chplProductNumber);
        				String cpSearchDetailsJson = HttpUtil.getRequest(props.getProperty("chplUrlBegin") + props.getProperty("basePath") + 
        	    				String.format(props.getProperty("getCertifiedProductDetails"), flatSearchResult.getId()), null, props);
        	    		ObjectMapper mapper = new ObjectMapper();
        				CertifiedProductSearchDetails cpDetails = mapper.readValue(cpSearchDetailsJson, CertifiedProductSearchDetails.class);
        				logger.info("Retrieved CertifiedProductSearchDetails: " + cpDetails.getChplProductNumber() + " " + cpDetails.getId());
        				allCPSearchDetails.add(cpDetails);
        			}
        		}
        	}
    		return allCPSearchDetails;
    }
    
    private void updateDisclosureURLs(Properties props, List<CertifiedProductSearchDetails> iCSAManagedCPSearchDetails, Token token) throws JsonProcessingException{
    	for(CertifiedProductSearchDetails cpDetails : iCSAManagedCPSearchDetails){
    		logger.info("Update disclosure URL for " + cpDetails.getChplProductNumber());
    		Long startTime = System.currentTimeMillis();
    		cpDetails.setTransparencyAttestationUrl(props.getProperty("transparencyAttestationUrl"));
    		ListingUpdateRequest listingUpdate = new ListingUpdateRequest();
			listingUpdate.setBanDeveloper(false);
			listingUpdate.setListing(cpDetails);
			String url = props.getProperty("chplUrlBegin") + props.getProperty("basePath") + props.getProperty("updateCertifiedProduct");
    		ObjectMapper mapper = new ObjectMapper();
			String jsonUpdateRequest = mapper.writeValueAsString(listingUpdate);
			HttpUtil.postAuthenticatedBodyRequest(url, null, props, token.getToken(), jsonUpdateRequest);
			token = token.getRefreshedToken(token, props);
			Long elapsedTime = System.currentTimeMillis() - startTime;
			logger.info("Finished updating Disclosure URL for " + cpDetails.getChplProductNumber() + " in " + 
					String.format("%d min, %d sec", TimeUnit.MILLISECONDS.toMinutes(elapsedTime), 
							TimeUnit.MILLISECONDS.toSeconds(elapsedTime) - TimeUnit.MINUTES.toSeconds(TimeUnit.MILLISECONDS.toMinutes(elapsedTime))));
        }
    }
    
    private void printChplProductNumbers(List<CertifiedProductSearchDetails> cpSearchDetails){
    	for(CertifiedProductSearchDetails cpDetail : cpSearchDetails){
    		System.out.println(cpDetail.getChplProductNumber());
    	}
    }
    
    private void printCertifiedProductId(List<CertifiedProductSearchDetails> cpSearchDetails){
    	for(CertifiedProductSearchDetails cpDetail : cpSearchDetails){
    		System.out.println(cpDetail.getId());
    	}
    }
    
}
